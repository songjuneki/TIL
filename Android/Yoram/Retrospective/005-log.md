# 게시판 기능 개발(~23.09.16) 회고록

## Fact

- 개발 방법 모색
- SQL 삽질과 백엔드 서버 게시판 기능 구현
- Flow 및 Paging3 라이브러리 학습 및 활용
- Jetpack Navigation 공부
- 안드로이드 권장 아키텍처 적용

## Feeling

- 게시판 기능을 만들기 위해서 어떤 방법이 있는지 찾아봤다.  
  1. 서버에 게시판 기능을 새로 만들기
  2. 홈페이지 데이터 연동하기
  3. 네이버 밴드 연동하기  

    이러한 방법이 있었지만 1안은 가장 이상적인 방법이겠지만 시간이 상당히 오래걸린다. 심지어 이 기능은 백엔드까지 신경을 써야할 부분이 많기 때문에 배제됐다. 3안도 역시 좋은 방법이다. 하지만 네이버 계정을 연동시켜야 하며 이 과정에서 iOS 앱 출시를 위해선 애플 SSO 까지 구현을 해야하고(애플 앱스토어 정책이다.) 사용자 입장에서 굳이 잘 만들어진 네이버 밴드 앱을 놔두고 사용할까 의문을 가졌다. 그래서 선택하게 된 2안인데. 현재 교회 홈페이지는 워드프레스로 구현됐고 워드프레스에서 기본적으로 지원하는 REST API를 이용하면 될 것이라고 생각했는데... 게시판은 워드프레스의 플러그인 기능인 하나보드와 Kboard 로 돼있어서 워드프레스의 REST API로 게시글을 뽑아내는게 상당히 어려웠다.. 그래서 하게 된 것이 SQL 삽질이다.

- 홈페이지의 DB 구조를 보며 데이터를 이리저리 조인하고 합치고 질의한 끝에 게시판 목록, 게시판의 게시글 목록, 게시글 데이터를 딱 필요한 정보만 얻어낼 수 있게 됐다. 이상적인 방법은 아니지만 교회 홈페이지 담당자도 이렇게 사용하라고 한다.  
이제 앱 백엔드 서버에서도 교회 홈페이지 데이터 소스도 구현하여 API를 만들었다. 이 정도면 난 백엔드에도 재능이 있는게 아닐까 싶다.

- 이제 앱에서도 기능을 구현해야하는데 게시글 리스트 구현을 위해 Paging 라이브러리를 처음 접하여 학습했다. Paging3 에서는 LiveData 뿐만 아니라 Flow 역시 최고 수준으로 지원하기도 하고 Flow 역시 학습해둘 필요가 있어서 게시판 Fragment 는 LiveData를 활용하는게 아닌 Flow를 활용하여 구현하기로 했다.  
처음 적용하여 구현한 코드베이스는 LiveData를 사용하는 것과 유사하게 구현을 했다. 그러다 보니 다른 Fragment를 전환 후 복귀시 모든 데이터가 초기화되어 새로 불러오는 문제가 발생했다.  
이 문제의 원인을 찾는 대에도 시간이 많이 걸렸다. 먼저 원인이라 생각한 것은 스크롤 포지션과 같은 현재 상태를 저장하지 못했기 때문이라 생각했다. 그래서 데이터를 ViewModel에 저장해보는 방식으로 해결해보려고 했지만 코드가 복잡해지고 문제 해결이 전혀 되지가 않았다. View가 생성되는 과정에서 데이터를 새로 불러오기 때문이지도 의심되어 Jetpack Navigation 에 대해서도 알아보게 됐다. Jetpack Navigation 2.4.0 이전 버전에서는 Multiple backstacks 을 지원하지 않아 구글에서 확장 함수로 구현한 Multiple backstacks 가 있다. 이 확장을 통해서 적용해보니 View는 생성된 채로 백그라운드에 있어 다시 복귀할 땐 onCreateView() 및 onViewCreated() 함수를 거치지 않아 View 가 생성될 때 데이터를 새로 불러와서 의도치 않은 동작을 한다는 것을 알게 됐다. 하지만 Jetpack Navigation 2.4.0 버전부터는 기본적으로 Multiple backstacks 을 지원하기 때문에 굳이 이전 버전을 사용하며 확장 함수로 이용한 구현을 할 정당성이 없었다.  
이와 같은 이유와 내가 Flow로 구현한 로직이 MVVM 아키텍처 및 안드로이드에 합당한 코드가 아니기에 구글에서 권장하는 아키텍처 스타일로 리팩토링할 필요성이 있었다.

- 구글, 안드로이드에서 권장하는 아키텍처는 클린 아키텍처와 같다고 볼 수 있다. 클린 아키텍처를 이용한 설계를 해보고 싶었는데 구글에서도 이와 같은 아키텍처를 권장하고 가이드로 하니 나에게 큰 도움이 됐다. 설계하는 것이 추상적이고 구현해야하는 것마다 기능과 형식이 다르다 보니 이해하고 앱에 적용하는 것이 오래걸렸다. 시간을 들인 만큼 충분히 이해하고 적용하다 보니 확실하게 각 레이어가 분리되어 관심사가 명확하고 어떤 기능을 담당하는 코드를 구현해야 하는지 알 수 있었다. 또 같이 권장하는 기술인 Flow 에 대해서도 어떻게 활용하는지 배울 수 있었다.

## Finding

- 여러 백엔드 지식(Springboot, SQL, DB, Wordpress 관련)
- Flow
- Paging3
- Jetpack Navigation - Multiple backstacks
- 안드로이드 권장 아키텍처

## Future Action

- 게시판 Swipe to refresh 구현
- 게시판 기능 확장 - 게시글 상세보기
- 홈 - 게시판 대시보드 추가
- 다른 화면에서도 안드로이드 권장 아키텍처 적용

## Feedback

- 안드로이드 권장 아키텍처가 아직 익숙치가 않다. 더 많은 기능을 해당 아키텍처로 구현해봐야 한다. 게시판 관리 역시 해당 아키텍처로 만들어 보고 가능하다면 이미 구현한 기능들도 리팩토링 해보자
